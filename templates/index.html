{% extends "base.html" %}

{% block title %}発音評価{% endblock %}

{% block extra_css %}
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<style>
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
    
    /* 反馈部分的样式 */
    .feedback-section {
        margin-top: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .feedback-section h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 1.2em;
    }
    
    .feedback-section h4 {
        margin: 10px 0;
        color: #555;
        font-size: 1.1em;
    }
    
    .score-section {
        margin-bottom: 20px;
    }
    
    .score-items {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    
    .score-item {
        background-color: white;
        padding: 10px 15px;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .score-label {
        font-weight: bold;
        color: #666;
        margin-right: 8px;
    }
    
    .score {
        color: #4CAF50;
        font-weight: bold;
    }
    
    .feedback-text {
        margin-top: 15px;
    }
    
    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
        font-family: inherit;
    }
    
    textarea[readonly] {
        background-color: #fff;
        cursor: default;
    }
</style>
{% endblock %}

{% block content %}
<!-- 文章を読む Tab -->
<div id="readTab" class="tab-content active">
    <div class="container" id="ttscont">
    </div>

    <div class=container id="formcontainer">
        <form id="reftextform">
            <textarea id="reftext" rows="3" cols="80" name="reftext" maxlength="160" autofocus placeholder="ここに参照テキストを入力してください..."></textarea>
        </form>
        <br>
    </div>

    <div class="button-container">
        <button id="buttonhear" class="h-button">
            <span class="fas fa-headphones"></span>発音を学ぶ</button>
        <button id="randomtt" class="blue-button">
            <span class="fa fa-random"></span>ランダム</button>
        <button id="generateText" class="blue-button">
            <span class="fa fa-file-alt"></span>ランダム文章</button>
        <button id="buttonmic" class="green-button">
            <span class="fa fa-microphone"></span>新しい録音</button>
    </div>

    <div class="container" id="recordcont">
        <div id="ttsList"></div>
        <div class="container" id="ttsloader">
            <div id="loader"></div>
        </div>
        <div id="recordingsList"></div>

        <div class="container" id="recordloader">
            <div id="loader"></div>
        </div>
        
        <div id="metrics" class="animate-bottom">
            <div class=container>
                <div id="summarytable">
                    <table>
                        <tr>
                            <th>正確性スコア</th>
                            <th>流暢さスコア</th>
                            <th>完全性スコア</th>
                            <th>発音スコア</th>
                            <th id="woh">省略された単語</th>
                            <th id="wih">余分に話された単語</th>
                        </tr>
                        <tr>
                            <td id="accuracyscore"></td>
                            <td id="fluencyscore"></td>
                            <td id="completenessscore"></td>
                            <td id="pronscore"></td>
                            <td id="wordsomitted"></td>
                            <td id="wordsinserted"></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="container">
                <div id="detailedtable">
                    <table>
                        <tr id="wordrow"></tr>
                        <tr id="phonemerow"></tr>
                        <tr id="scorerow"></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Topic Tab -->
<div id="topicTab" class="tab-content">
    <div class="container">
        <textarea id="topicText" rows="3" cols="80" placeholder="ここにトピックが表示されます..."></textarea>
    </div>
    <div class="button-container">
        <button id="generateTopic" class="blue-button">
            <span class="fa fa-lightbulb"></span>トピックを生成</button>
        <button id="recordTopic" class="green-button">
            <span class="fa fa-microphone"></span>録音</button>
    </div>
    <div class="container">
        <textarea id="transcribedText" rows="5" cols="80" placeholder="ここに音声認識の結果が表示されます..." readonly></textarea>
    </div>
    <div class="container">
        <div class="feedback-section">
            <h3>文法の修正</h3>
            <textarea id="grammarCorrection" rows="5" cols="80" placeholder="文法の修正と提案が表示されます..." readonly></textarea>
            <h3>フィードバック</h3>
            <div id="feedbackContent" class="feedback-content">
                <div class="score-section">
                    <h4>評価スコア</h4>
                    <div class="score-items">
                        <div class="score-item">
                            <span class="score-label">文法:</span>
                            <span id="grammarScore" class="score">-</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">内容:</span>
                            <span id="contentScore" class="score">-</span>
                        </div>
                        <div class="score-item">
                            <span class="score-label">トピックとの関連性:</span>
                            <span id="relevanceScore" class="score">-</span>
                        </div>
                    </div>
                </div>
                <div class="feedback-text">
                    <h4>アドバイス</h4>
                    <textarea id="feedbackText" rows="5" cols="80" placeholder="アドバイスが表示されます..." readonly></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 練習 Tab -->
<div id="practiceTab" class="tab-content">
    <!-- 将来的に追加する練習コンテンツ -->
</div>

<footer id=footeralert>マイクの使用を許可してください。</footer>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='index.js') }}"></script>
<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
{% endblock %}
